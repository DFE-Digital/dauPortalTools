% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ui_school_ofsted_history.R
\name{ui_school_ofsted_history}
\alias{ui_school_ofsted_history}
\title{Render Ofsted Inspection Panel}
\usage{
ui_school_ofsted_history(urn)
}
\arguments{
\item{urn}{A length‑1 numeric or character Unique Reference Number (URN) for
the school whose Ofsted inspection data should be displayed.}
}
\value{
A Shiny UI object containing the complete GOV.UK-styled Ofsted panel.
If no inspection data is found for the given URN, a user‑friendly message is
returned instead.
}
\description{
Generates a standalone GOV.UK-styled Ofsted inspection panel for a given URN.
The panel contains its own tabset and mirrors the structure of the new Ofsted
report‑card model, including coloured grade pills, an accessible safeguarding
panel, and an expandable “Our grades explained” section.
}
\details{
This function produces \strong{two tabs}:

\strong{1. Latest Inspection}
\itemize{
\item Attempts to load the most recent post–September 2025 inspection from
\code{[ofsted_weekly_graded]}.
\item If no new‑framework inspection exists, the function falls back to the
most recent record in
\code{[ofsted_weekly_graded_pre0925]}.
\item Displays:
\itemize{
\item Inspection date
\item New‑framework 5‑point grades (or legacy 4‑grade set, if falling back)
\item Coloured, ARIA‑labelled grade pills
\item Safeguarding status presented in an ARIA‑labelled panel
\item An expandable “Our grades explained” section aligned to the
new report‑card model
}
}

\strong{2. Inspection History}
\itemize{
\item Includes two tables:
\enumerate{
\item All post–Sep 2025 inspections for the URN from
\code{ofsted_weekly_graded}, with a placeholder
\code{category_of_concern = "coming soon"}.
\item All pre–Sep 2025 inspections for the URN from
\code{ofsted_weekly_graded_pre0925}, including the legacy grade
judgements, category of concern, and safeguarding effectiveness.
}
\item Tables are rendered using \code{DT::datatable()}.
}

\strong{Data sources}
\itemize{
\item \emph{New framework (post–September 2025)}:
\code{[ofsted_weekly_graded]}
\item \emph{Previous framework (pre–September 2025)}:
\code{[ofsted_weekly_graded_pre0925]}
}

\strong{Logic}
\enumerate{
\item Attempt to select the latest inspection under the new framework
(inspection_date ≥ \code{2025‑09‑01}).
  \item If not present, fall back to the most recent previous‑framework record.
\item Construct the history tab from:
\itemize{
\item All new‑framework rows for the URN (plus placeholder category).
\item All previous‑framework rows for the URN.
}
}

\strong{Presentation}
\itemize{
\item New‑framework grades are mapped to the five-category model
(\emph{Exceptional}, \emph{Strong standard},
\emph{Expected standard}, \emph{Needs attention},
\emph{Urgent improvement}).
\item Previous‑framework grades (Outstanding, Good, Requires Improvement,
Inadequate) are displayed with a separate pill‑colour scheme.
\item Safeguarding status is displayed as “Met” or “Not met” in a dedicated
panel.
}
}
\section{Accessibility}{

This function includes some accessibility enhancements:
\itemize{
\item Grade pills include \code{role="text"} and an \code{aria-label}
describing the grade to screen readers.
\item The safeguarding panel uses \code{role="group"} and an
\code{aria-label} announcing the safeguarding status.
\item All table headers use appropriate \code{scope="row"} and
\code{scope="col"} attributes for improved screen‑reader navigation.
}
}

\section{Dependencies}{

Requires an active SQL Server connection via \code{sql_manager("dit")}.
Uses \code{shinyGovstyle} for layout and \code{DT} for data tables.
}

\examples{
\dontrun{
if (interactive()) {
  ui <- fluidPage(
    uiOutput("ofsted_panel")
  )

  server <- function(input, output, session) {
    output$ofsted_panel <- renderUI({
      ui_school_ofsted_history(urn = 123456)  # Replace with a valid URN
    })
  }

  shinyApp(ui, server)
}
}

}
\seealso{
\code{\link{school_render_overview}} for the main school summary panel that
accompanies this Ofsted view.
}
